/*!
* spritz.js 2.3.0 - Modern and delightful sprites animation library for JavaScript!
*
* @author       maoosi <hello@sylvainsimao.fr>
* @homepage     https://github.com/maoosi/spritz.js
* @copyright    Copyright (c) 2019 maoosi <hello@sylvainsimao.fr>
* @license      MIT
* @version      2.3.0
*/
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t=t||self).Spritz=e()}(this,function(){"use strict";function n(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function s(t,e){return(s=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function r(t,e,i){return(r=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(t){return!1}}()?Reflect.construct:function(t,e,i){var n=[null];n.push.apply(n,e);var r=new(Function.bind.apply(t,n));return i&&s(r,i.prototype),r}).apply(null,arguments)}function a(t){var e=0<arguments.length&&void 0!==t?t:{},a=Object.create(null);function i(t,e){return a[t]=a[t]||[],a[t].push(e),this}function h(t){var e=1<arguments.length&&void 0!==arguments[1]&&arguments[1];return e?a[t].splice(a[t].indexOf(e),1):delete a[t],this}return o({},e,{on:i,once:function(t,e){return e._once=!0,i(t,e),this},off:h,emit:function(e){for(var i=this,t=arguments.length,n=Array(1<t?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];var s=a[e]&&a[e].slice();return s&&s.forEach(function(t){t._once&&h(e,t),t.apply(i,n)}),this}})}var o=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var i=arguments[e];for(var n in i)Object.prototype.hasOwnProperty.call(i,n)&&(t[n]=i[n])}return t},h=(function(t,e,i){return e&&u(t.prototype,e),i&&u(t,i),t}(t,[{key:"handle",value:function(t,e){var i=2<arguments.length&&void 0!==arguments[2]&&arguments[2];return this.waitQueue.push({func:e,timeout:this._isAsyncFunc(e)?"async":i}),this.waitExecution||this._next(),t}},{key:"pause",value:function(t,e){var i=2<arguments.length&&void 0!==arguments[2]?arguments[2]:function(){};return this.handle(t,i,e)}},{key:"_isAsyncFunc",value:function(t){return-1<t.toString().search("done()")}},{key:"_exec",value:function(t){var e=this;t.call(this,function(){e._next()})}},{key:"_next",value:function(){var t=this;if(0<this.waitQueue.length){this.waitExecution=!0;var e=this.waitQueue.shift(),i=e.func,n=e.timeout;"async"===n?this._exec(i):!1!==n?(this._exec(i),setTimeout(function(){t._next()},n)):(this._exec(i),this._next())}else this.waitExecution=!1}}]),t);function t(){(function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")})(this,t),this.waitQueue=[],this.waitExecution=!1}function u(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}var c=function(){function i(t){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,i),this.options={picture:e.picture||[],steps:e.steps||1,rows:e.rows||1,init:void 0!==e.init?e.init:1,testunit:e.testunit||!1},Array.isArray(this.options.picture)||(this.options.picture=[this.options.picture]),this.selector="string"==typeof t?document.querySelector(t):t,this.emitter=a(),this.waitter=function(){for(var t=arguments.length,e=Array(t),i=0;i<t;i++)e[i]=arguments[i];return new(Function.prototype.bind.apply(h,[null].concat(e)))}(),this.supportsWebP=this._supportsWebP(),this.initiated=!1,0<this.options.init?this.init(this.options.init):this}return function(t,e,i){e&&n(t.prototype,e),i&&n(t,i)}(i,[{key:"_globalVars",value:function(){this.canvas=!1,this.ctx=!1,this.loaded=!1,this._resetUntil(),this.anim=!1,this.columns=Math.ceil(this.options.steps/this.options.rows),this.currentFps=15,this.flipped=!1}},{key:"_throttle",value:function(n,r){var s,a,h=arguments,o=this;return function(){var t=o,e=+new Date,i=h;s&&e<s+r?(clearTimeout(a),a=setTimeout(function(){s=e,n.apply(t,i)},r)):(s=e,n.apply(t,i))}}},{key:"_bindEvents",value:function(){var t=this;this.resize=this._throttle(function(){t._resize()},250),window.addEventListener("resize",this.resize,!1)}},{key:"_unbindEvents",value:function(){window.removeEventListener("resize",this.resize,!1)}},{key:"_resize",value:function(){this._loadPicture(),this.emitter.emit("resize",this.pic)}},{key:"init",value:function(t){var e=this,i=0<arguments.length&&void 0!==t?t:1;return this.waitter.handle(this,function(){e.initiated||(e.initialStep=i,e.currentStep=i,e._globalVars(),e._bindEvents(),e._createCanvas(),e._loadPicture(),e.initiated=!0,e.emitter.emit("ready"))})}},{key:"destroy",value:function(){var t=this;return this.waitter.handle(this,function(){t.initiated&&(t.stop(),t._unbindEvents(),t.canvas.parentNode.removeChild(t.canvas),t.container.parentNode.removeChild(t.container),t.canvas=!1,t.ctx=!1,t.initiated=!1,t.emitter.emit("destroy"),t.emitter.off("ready"),t.emitter.off("destroy"),t.emitter.off("resize"),t.emitter.off("play"),t.emitter.off("load"),t.emitter.off("change"),t.emitter.off("wait"),t.emitter.off("flip"),t.emitter.off("pause"),t.emitter.off("stop"))})}},{key:"play",value:function(t){var e=this,i=0<arguments.length&&void 0!==t&&t;return this.waitter.handle(this,function(){e.animDirection="backward"===i?"backward":"forward",e._startAnimation(),e.emitter.emit("play",e.animDirection)})}},{key:"playback",value:function(){var t=this;return this.waitter.handle(this,function(){t.animDirection="backward",t._startAnimation(),t.emitter.emit("play",t.animDirection)})}},{key:"pause",value:function(t){var e=this,i=0<arguments.length&&void 0!==t&&t;return this.waitter.handle(this,function(){e._pauseAnimation(),i||e.emitter.emit("pause")})}},{key:"stop",value:function(){var t=this;return this.waitter.handle(this,function(){t.pause(!0),t.step(t.initialStep),t.emitter.emit("stop")})}},{key:"wait",value:function(t){var e=this,i=0<arguments.length&&void 0!==t?t:0;return this.waitter.handle(this,function(){e.emitter.emit("wait",i)},i)}},{key:"step",value:function(t){var e=this,i=0<arguments.length&&void 0!==t?t:1;return this.waitter.handle(this,function(){var t=e.currentStep;e.currentStep=i,e._draw(),e.emitter.emit("change",t,e.currentStep)})}},{key:"fps",value:function(t){var e=this;return this.waitter.handle(this,function(){e.currentFps=t})}},{key:"until",value:function(t,e){var i=this,n=1<arguments.length&&void 0!==e?e:1;return this.waitter.handle(this,function(){i.stopAtStep=t,i.stopAtLoop=n})}},{key:"next",value:function(){var e=this;return this.waitter.handle(this,function(){e.animDirection="forward";var t=e.currentStep;e.currentStep=e._targetStep(),e._draw(),e.emitter.emit("change",t,e.currentStep)})}},{key:"prev",value:function(){var e=this;return this.waitter.handle(this,function(){e.animDirection="backward";var t=e.currentStep;e.currentStep=e._targetStep(),e._draw(),e.emitter.emit("change",t,e.currentStep)})}},{key:"get",value:function(t,e){var i=this,n=1<arguments.length&&void 0!==e&&e;return this.waitter.handle(this,function(){switch(t){case"step":return!1!==n?n.call(i,i.currentStep):i.currentStep;case"picture":return!1!==n?n.call(i,i.pic):i.pic;default:return!1}})}},{key:"flip",value:function(){var e=this;return this.waitter.handle(this,function(){var t=e.flipped?"width:100%;height:100%;":"width:100%;height:100%;-webkit-transform:scale(-1, 1);-ms-transform:scale(-1, 1);transform:scale(-1, 1);-webkit-filter:FlipH;filter:FlipH;";e.container.setAttribute("style",t),e.flipped=!e.flipped,e.emitter.emit("flip")})}},{key:"on",value:function(){var t;return(t=this.emitter).on.apply(t,arguments)}},{key:"off",value:function(){var t;return(t=this.emitter).off.apply(t,arguments)}},{key:"_resetUntil",value:function(){this.stopAtLoop=!1,this.stopAtStep=!1}},{key:"_targetStep",value:function(){return"forward"===this.animDirection?this.currentStep<this.options.steps?this.currentStep+1:1:1<this.currentStep?this.currentStep-1:this.options.steps}},{key:"_animate",value:function(t){var e=this;if(this.initiated){void 0===this.animTime&&(this.animTime=t);var i=Math.floor((t-this.animTime)/(1e3/this.currentFps)),n=!1;if(i>this.animFrame){this.animFrame=i;var r=this.currentStep;this.currentStep=this._targetStep();var s=!0;this.currentStep===this.stopAtStep&&(this.currentLoop++,this.currentLoop===this.stopAtLoop&&(s=!1)),s?(this._draw(),this.emitter.emit("change",r,this.currentStep)):(this._draw(),this.pause(),n=!0)}n||this.requireStop||(this.anim=window.requestAnimationFrame(function(t){return e._animate(t)}))}}},{key:"_startAnimation",value:function(){var e=this;this.anim?(this.pause(),this.play(this.animDirection)):(this.requireStop=!1,this.animTime=void 0,this.animFrame=0,this.currentLoop=0,this.anim=window.requestAnimationFrame(function(t){return e._animate(t)}))}},{key:"_pauseAnimation",value:function(){this.anim&&(this._resetUntil(),this.requireStop=!0,window.cancelAnimationFrame(this.anim),this.anim=!1)}},{key:"_selectPicture",value:function(){for(var t=0;t<this.options.picture.length;t++){var e=this.options.picture[t];if(this._supportsFormat(e.srcset)&&this._matchesMedia(e.media))return(this.pic=e).srcset}return!1}},{key:"_supportsFormat",value:function(t){var e=this._getExtension(t);return"webp"===e&&this.supportsWebP||"webp"!==e}},{key:"_supportsWebP",value:function(){var t=document.createElement("canvas");return t.width=t.height=1,t.toDataURL&&t.toDataURL("image/webp")&&0===t.toDataURL("image/webp").indexOf("data:image/webp")}},{key:"_getExtension",value:function(t){return/[.]/.exec(t)?/[^.]+$/.exec(t)[0]:void 0}},{key:"_matchesMedia",value:function(t){var e=0<arguments.length&&void 0!==t?t:void 0,i=window.matchMedia(e);return void 0===e||i.matches}},{key:"_setDimensions",value:function(){this.stepWidth=this.pic.width/this.columns,this.stepHeight=this.pic.height/this.options.rows,this.stepRatio=this.stepWidth/this.stepHeight,this.parentWidth=this.selector.clientWidth,this.parentHeight=this.selector.clientHeight,this.parentRatio=this.parentWidth/this.parentHeight,"cover"===this.pic.objectFit?this.stepRatio>=this.parentRatio?(this.canvasHeight=this.parentHeight,this.canvasWidth=this.stepWidth*this.canvasHeight/this.stepHeight):(this.canvasWidth=this.parentWidth,this.canvasHeight=this.stepHeight*this.canvasWidth/this.stepWidth):this.stepRatio>=this.parentRatio?(this.canvasWidth=this.parentWidth,this.canvasHeight=this.stepHeight*this.canvasWidth/this.stepWidth):(this.canvasHeight=this.parentHeight,this.canvasWidth=this.stepWidth*this.canvasHeight/this.stepHeight),this.canvas.width=this.canvasWidth,this.canvas.height=this.canvasHeight}},{key:"_loadPicture",value:function(){var t=this;this.picture=new Image,this.picture.onload=function(){t.pic.width||(t.pic.width=t.picture.naturalWidth),t.pic.height||(t.pic.height=t.picture.naturalHeight),t.loaded||(t.emitter.emit("load",t.pic),t.loaded=!0),t._draw()},this.picture.src=this._selectPicture()}},{key:"_draw",value:function(){this.initiated&&(this._setDimensions(),this._drawPicture())}},{key:"_drawPicture",value:function(){var t=Math.floor((this.currentStep-1)%this.columns),e=Math.floor((this.currentStep-1)/this.columns),i=t*this.stepWidth,n=e*this.stepHeight;this.options.testunit||(this.ctx.clearRect(0,0,this.canvasWidth,this.canvasHeight),this.ctx.drawImage(this.picture,Math.round(i),Math.round(n),this.stepWidth,this.stepHeight,0,0,this.canvasWidth,this.canvasHeight))}},{key:"_createCanvas",value:function(){this.canvas=document.createElement("canvas"),this.canvas.setAttribute("style","position:absolute;left:50%;top:50%;-webkit-transform:translateY(-50%) translateY(1px) translateX(-50%) translateX(1px);-ms-transform:translateY(-50%) translateY(1px) translateX(-50%) translateX(1px);transform:translateY(-50%) translateY(1px) translateX(-50%) translateX(1px);"),this.container=document.createElement("div"),this.container.setAttribute("style","width:100%;height:100%;position:relative;"),this.container.appendChild(this.canvas),this.selector.appendChild(this.container),this.ctx=this.canvas.getContext("2d")}}]),i}();return function(){for(var t=arguments.length,e=new Array(t),i=0;i<t;i++)e[i]=arguments[i];return r(c,e)}});
//# sourceMappingURL=spritz.js.map
