/*!
* spritz.js 2.3.0 - Modern and delightful sprites animation library for JavaScript!
*
* @author       maoosi <hello@sylvainsimao.fr>
* @homepage     https://github.com/maoosi/spritz.js
* @copyright    Copyright (c) 2019 maoosi <hello@sylvainsimao.fr>
* @license      MIT
* @version      2.3.0
*/
function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function e(t,i){return(e=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,i)}function i(t,n,r){return(i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}()?Reflect.construct:function(t,i,n){var r=[null];r.push.apply(r,i);var a=new(Function.bind.apply(t,r));return n&&e(a,n.prototype),a}).apply(null,arguments)}var n=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var i=arguments[e];for(var n in i)Object.prototype.hasOwnProperty.call(i,n)&&(t[n]=i[n])}return t},r=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=Object.create(null);function i(t,i){return e[t]=e[t]||[],e[t].push(i),this}function r(t,e){return e._once=!0,i(t,e),this}function a(t){var i=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return i?e[t].splice(e[t].indexOf(i),1):delete e[t],this}function s(t){for(var i=this,n=arguments.length,r=Array(n>1?n-1:0),s=1;s<n;s++)r[s-1]=arguments[s];var h=e[t]&&e[t].slice();return h&&h.forEach((function(e){e._once&&a(t,e),e.apply(i,r)})),this}return n({},t,{on:i,once:r,off:a,emit:s})},a=function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")},s=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),h=function(){function t(){a(this,t),this.waitQueue=[],this.waitExecution=!1}return s(t,[{key:"handle",value:function(t,e){var i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return this.waitQueue.push({func:e,timeout:this._isAsyncFunc(e)?"async":i}),this.waitExecution||this._next(),t}},{key:"pause",value:function(t,e){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:function(){};return this.handle(t,i,e)}},{key:"_isAsyncFunc",value:function(t){return t.toString().search("done()")>-1}},{key:"_exec",value:function(t){var e=this;t.call(this,(function(){e._next()}))}},{key:"_next",value:function(){var t=this;if(this.waitQueue.length>0){this.waitExecution=!0;var e=this.waitQueue.shift(),i=e.func,n=e.timeout;"async"===n?this._exec(i):!1!==n?(this._exec(i),setTimeout((function(){t._next()}),n)):(this._exec(i),this._next())}else this.waitExecution=!1}}]),t}(),o=function(){for(var t=arguments.length,e=Array(t),i=0;i<t;i++)e[i]=arguments[i];return new(Function.prototype.bind.apply(h,[null].concat(e)))},u=function(){function e(t){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),this.options={picture:i.picture||[],steps:i.steps||1,rows:i.rows||1,init:void 0!==i.init?i.init:1,testunit:i.testunit||!1},Array.isArray(this.options.picture)||(this.options.picture=[this.options.picture]),this.selector="string"==typeof t?document.querySelector(t):t,this.emitter=r(),this.waitter=o(),this.supportsWebP=this._supportsWebP(),this.initiated=!1,this.options.init>0?this.init(this.options.init):this}var i,n,a;return i=e,(n=[{key:"_globalVars",value:function(){this.canvas=!1,this.ctx=!1,this.loaded=!1,this._resetUntil(),this.anim=!1,this.columns=Math.ceil(this.options.steps/this.options.rows),this.currentFps=15,this.flipped=!1}},{key:"_throttle",value:function(t,e){var i,n,r=arguments,a=this;return function(){var s=a,h=+new Date,o=r;i&&h<i+e?(clearTimeout(n),n=setTimeout((function(){i=h,t.apply(s,o)}),e)):(i=h,t.apply(s,o))}}},{key:"_bindEvents",value:function(){var t=this;this.resize=this._throttle((function(){t._resize()}),250),window.addEventListener("resize",this.resize,!1)}},{key:"_unbindEvents",value:function(){window.removeEventListener("resize",this.resize,!1)}},{key:"_resize",value:function(){this._loadPicture(),this.emitter.emit("resize",this.pic)}},{key:"init",value:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;return this.waitter.handle(this,(function(){t.initiated||(t.initialStep=e,t.currentStep=e,t._globalVars(),t._bindEvents(),t._createCanvas(),t._loadPicture(),t.initiated=!0,t.emitter.emit("ready"))}))}},{key:"destroy",value:function(){var t=this;return this.waitter.handle(this,(function(){t.initiated&&(t.stop(),t._unbindEvents(),t.canvas.parentNode.removeChild(t.canvas),t.container.parentNode.removeChild(t.container),t.canvas=!1,t.ctx=!1,t.initiated=!1,t.emitter.emit("destroy"),t.emitter.off("ready"),t.emitter.off("destroy"),t.emitter.off("resize"),t.emitter.off("play"),t.emitter.off("load"),t.emitter.off("change"),t.emitter.off("wait"),t.emitter.off("flip"),t.emitter.off("pause"),t.emitter.off("stop"))}))}},{key:"play",value:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return this.waitter.handle(this,(function(){t.animDirection="backward"===e?"backward":"forward",t._startAnimation(),t.emitter.emit("play",t.animDirection)}))}},{key:"playback",value:function(){var t=this;return this.waitter.handle(this,(function(){t.animDirection="backward",t._startAnimation(),t.emitter.emit("play",t.animDirection)}))}},{key:"pause",value:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return this.waitter.handle(this,(function(){t._pauseAnimation(),e||t.emitter.emit("pause")}))}},{key:"stop",value:function(){var t=this;return this.waitter.handle(this,(function(){t.pause(!0),t.step(t.initialStep),t.emitter.emit("stop")}))}},{key:"wait",value:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return this.waitter.handle(this,(function(){t.emitter.emit("wait",e)}),e)}},{key:"step",value:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;return this.waitter.handle(this,(function(){var i=t.currentStep;t.currentStep=e,t._draw(),t.emitter.emit("change",i,t.currentStep)}))}},{key:"fps",value:function(t){var e=this;return this.waitter.handle(this,(function(){e.currentFps=t}))}},{key:"until",value:function(t){var e=this,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return this.waitter.handle(this,(function(){e.stopAtStep=t,e.stopAtLoop=i}))}},{key:"next",value:function(){var t=this;return this.waitter.handle(this,(function(){t.animDirection="forward";var e=t.currentStep;t.currentStep=t._targetStep(),t._draw(),t.emitter.emit("change",e,t.currentStep)}))}},{key:"prev",value:function(){var t=this;return this.waitter.handle(this,(function(){t.animDirection="backward";var e=t.currentStep;t.currentStep=t._targetStep(),t._draw(),t.emitter.emit("change",e,t.currentStep)}))}},{key:"get",value:function(t){var e=this,i=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return this.waitter.handle(this,(function(){switch(t){case"step":return!1!==i?i.call(e,e.currentStep):e.currentStep;case"picture":return!1!==i?i.call(e,e.pic):e.pic;default:return!1}}))}},{key:"flip",value:function(){var t=this;return this.waitter.handle(this,(function(){var e=t.flipped?"width:100%;height:100%;":"width:100%;height:100%;-webkit-transform:scale(-1, 1);-ms-transform:scale(-1, 1);transform:scale(-1, 1);-webkit-filter:FlipH;filter:FlipH;";t.container.setAttribute("style",e),t.flipped=!t.flipped,t.emitter.emit("flip")}))}},{key:"on",value:function(){var t;return(t=this.emitter).on.apply(t,arguments)}},{key:"off",value:function(){var t;return(t=this.emitter).off.apply(t,arguments)}},{key:"_resetUntil",value:function(){this.stopAtLoop=!1,this.stopAtStep=!1}},{key:"_targetStep",value:function(){return"forward"===this.animDirection?this.currentStep<this.options.steps?this.currentStep+1:1:this.currentStep>1?this.currentStep-1:this.options.steps}},{key:"_animate",value:function(t){var e=this;if(this.initiated){void 0===this.animTime&&(this.animTime=t);var i=Math.floor((t-this.animTime)/(1e3/this.currentFps)),n=!1;if(i>this.animFrame){this.animFrame=i;var r=this.currentStep;this.currentStep=this._targetStep();var a=!0;this.currentStep===this.stopAtStep&&(this.currentLoop++,this.currentLoop===this.stopAtLoop&&(a=!1)),a?(this._draw(),this.emitter.emit("change",r,this.currentStep)):(this._draw(),this.pause(),n=!0)}n||this.requireStop||(this.anim=window.requestAnimationFrame((function(t){return e._animate(t)})))}}},{key:"_startAnimation",value:function(){var t=this;this.anim?(this.pause(),this.play(this.animDirection)):(this.requireStop=!1,this.animTime=void 0,this.animFrame=0,this.currentLoop=0,this.anim=window.requestAnimationFrame((function(e){return t._animate(e)})))}},{key:"_pauseAnimation",value:function(){this.anim&&(this._resetUntil(),this.requireStop=!0,window.cancelAnimationFrame(this.anim),this.anim=!1)}},{key:"_selectPicture",value:function(){for(var t=0;t<this.options.picture.length;t++){var e=this.options.picture[t];if(this._supportsFormat(e.srcset)&&this._matchesMedia(e.media))return this.pic=e,e.srcset}return!1}},{key:"_supportsFormat",value:function(t){var e=this._getExtension(t);return"webp"===e&&this.supportsWebP||"webp"!==e}},{key:"_supportsWebP",value:function(){var t=document.createElement("canvas");return t.width=t.height=1,t.toDataURL&&t.toDataURL("image/webp")&&0===t.toDataURL("image/webp").indexOf("data:image/webp")}},{key:"_getExtension",value:function(t){return/[.]/.exec(t)?/[^.]+$/.exec(t)[0]:void 0}},{key:"_matchesMedia",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:void 0,e=window.matchMedia(t);return void 0===t||e.matches}},{key:"_setDimensions",value:function(){this.stepWidth=this.pic.width/this.columns,this.stepHeight=this.pic.height/this.options.rows,this.stepRatio=this.stepWidth/this.stepHeight,this.parentWidth=this.selector.clientWidth,this.parentHeight=this.selector.clientHeight,this.parentRatio=this.parentWidth/this.parentHeight,"cover"===this.pic.objectFit?this.stepRatio>=this.parentRatio?(this.canvasHeight=this.parentHeight,this.canvasWidth=this.stepWidth*this.canvasHeight/this.stepHeight):(this.canvasWidth=this.parentWidth,this.canvasHeight=this.stepHeight*this.canvasWidth/this.stepWidth):this.stepRatio>=this.parentRatio?(this.canvasWidth=this.parentWidth,this.canvasHeight=this.stepHeight*this.canvasWidth/this.stepWidth):(this.canvasHeight=this.parentHeight,this.canvasWidth=this.stepWidth*this.canvasHeight/this.stepHeight),this.canvas.width=this.canvasWidth,this.canvas.height=this.canvasHeight}},{key:"_loadPicture",value:function(){var t=this;this.picture=new Image,this.picture.onload=function(){t.pic.width||(t.pic.width=t.picture.naturalWidth),t.pic.height||(t.pic.height=t.picture.naturalHeight),t.loaded||(t.emitter.emit("load",t.pic),t.loaded=!0),t._draw()},this.picture.src=this._selectPicture()}},{key:"_draw",value:function(){this.initiated&&(this._setDimensions(),this._drawPicture())}},{key:"_drawPicture",value:function(){var t=Math.floor((this.currentStep-1)%this.columns),e=Math.floor((this.currentStep-1)/this.columns),i=t*this.stepWidth,n=e*this.stepHeight;this.options.testunit||(this.ctx.clearRect(0,0,this.canvasWidth,this.canvasHeight),this.ctx.drawImage(this.picture,Math.round(i),Math.round(n),this.stepWidth,this.stepHeight,0,0,this.canvasWidth,this.canvasHeight))}},{key:"_createCanvas",value:function(){this.canvas=document.createElement("canvas"),this.canvas.setAttribute("style","position:absolute;left:50%;top:50%;-webkit-transform:translateY(-50%) translateY(1px) translateX(-50%) translateX(1px);-ms-transform:translateY(-50%) translateY(1px) translateX(-50%) translateX(1px);transform:translateY(-50%) translateY(1px) translateX(-50%) translateX(1px);"),this.container=document.createElement("div"),this.container.setAttribute("style","width:100%;height:100%;position:relative;"),this.container.appendChild(this.canvas),this.selector.appendChild(this.container),this.ctx=this.canvas.getContext("2d")}}])&&t(i.prototype,n),a&&t(i,a),e}();export default function(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];return i(u,e)}
//# sourceMappingURL=spritz.mjs.map
